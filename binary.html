
<!DOCTYPE html>
<html>
<head>
	<title>Ensemble Weather</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
   <script type="text/javascript" src="slocum.js"></script>
	 <style type="text/css">
  	 #map { height: 800px;}
     .leaflet-popup-content {
       width: auto !important;
     }
	 </style>
</head>
<body>

<div id="map"></div>

<div id="button-wrapper">
    <button onclick="changeValidTime()">next</button>
</div>

<div id="fcst-info">
Forecast for 0 hours from now
</div>

<dev id="spot"></div>


<script type="text/javascript">

var preloaded_data = []

var map = L.map('map', {
    minZoom: 2,
    maxZoom: 12
  }).setView([21, 203.0], 9);

var files = ["000.bin",
             "006.bin",
             "012.bin",
             "018.bin",
             "024.bin",
             "030.bin",
             "036.bin",
             "042.bin",
             "048.bin"];
var index = 0

L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox/streets-v11',
      tileSize: 512,
      zoomOffset: -1,
      accessToken: 'pk.eyJ1IjoiYWtsZWVtYW4iLCJhIjoiY2txNGVkaHhwMGc2eDJwb3plNTh0aWJnZyJ9.l78GPBIaV7WwxqKtgEG76A'
  }).addTo(map);

var wind_circle_layer = L.layerGroup().addTo(map);

map.on('moveend', function() {
  map.removeLayer(wind_circle_layer);
  Draw(map, preloaded_data)  
});

map.on('zoomend', function() {
  var zoomlevel = map.getZoom();
  if (zoomlevel < 10){
    console.log("no point layer active");
  }
  if (zoomlevel >= 10){
    console.log("layer already added");
  }
  console.log("Current Zoom Level =" + zoomlevel)
  map.removeLayer(wind_circle_layer);
  Draw(map, preloaded_data)
});

function ParseAndDraw(bytes) {
  preloaded_data = ParseSlocum(bytes);
  wind_circle_layer = Draw(map, preloaded_data);
}

function changeValidTime() {

  index = index + 1
  if (index >= files.length) {
    index = 0
  }
  
  var hours = 6 * index
  document.getElementById("fcst-info").innerHTML = "Forecast for " + hours.toString() + " from now"
  
  LoadFile(files[index], ParseAndDraw)
}

console.log("loading")
LoadFile(files[0], ParseAndDraw)
console.log("loaded")

</script>
</body>
</html> 
